<!DOCTYPE html>
<html>
<head>
  <title>Process Checklist</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    label { display: block; margin: 5px 0; }
    button { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Process Checklist</h1>
  <div id="content">Loading...</div>
  <script>
    const apiUrl = 'https://script.google.com/macros/s/AKfycbyPzJ06ey4B2dUPlmODzmvh8dHxAoGS3KlOM3TKir4jiNeGupZ9asOVev4kEnLEGTao/exec';

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        let html = `<h2>${data.processName}</h2><form id="checklist">`;

        data.steps.forEach((step, i) => {
          html += `<h3>Step ${i + 1}: ${step.stepName}</h3>`;
          step.subparts.forEach((item, j) => {
            const id = `s${i}_i${j}`;
            html += `<label><input type="checkbox" id="${id}"> ${item}</label>`;
          });
        });

        html += `<button type="submit">Submit</button></form>`;
        document.getElementById('content').innerHTML = html;

        document.getElementById("checklist").addEventListener("submit", function(e) {
          e.preventDefault();
          localStorage.setItem("checklist_submitted", "yes");
          alert("Checklist submitted. You cannot edit it anymore.");
          disableForm();
        });

        if (localStorage.getItem("checklist_submitted") === "yes") {
          disableForm();
        }

        function disableForm() {
          const checkboxes = document.querySelectorAll("input[type=checkbox]");
          checkboxes.forEach(cb => cb.disabled = true);
          document.querySelector("button").disabled = true;
        }
      });
  </script>
</body>
</html>
